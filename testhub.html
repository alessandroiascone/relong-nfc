<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Re Long ‚Ä¢ Fidelity Card</title>
  <meta name="theme-color" content="#05060a">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-font-smoothing:antialiased}
    :root{
      --bg1:#04050a;--bg2:#050712;
      --accent1:#facc15;--accent2:#f97316;
      --accent3:#22c55e;--stroke:rgba(255,255,255,.08);
      --muted:rgba(226,232,255,.72);--muted2:rgba(148,163,184,.9);
      --danger:#ef4444;
    }
    body{
      min-height:100vh;
      font-family:system-ui,-apple-system,Inter,Roboto,sans-serif;
      background:radial-gradient(circle at 0% 0%,#111827 0%,#020617 56%,#000 100%);
      color:#e5e7eb;
      display:flex;align-items:center;justify-content:center;
      padding:20px;
    }
    body::before{
      content:"";position:fixed;inset:auto;top:-200px;left:50%;
      transform:translateX(-50%);
      width:900px;height:900px;border-radius:50%;
      background:radial-gradient(circle,#f97316 0%,transparent 60%);
      opacity:.15;filter:blur(10px);pointer-events:none;z-index:-1;
    }
    .shell{
      width:100%;max-width:900px;margin:auto;
      display:grid;gap:18px;
    }
    header.head{text-align:center}
    header.head h1{
      font-size:22px;font-weight:900;letter-spacing:-.03em;
      display:flex;justify-content:center;align-items:center;gap:8px;
    }
    header.head span.logo{
      width:22px;height:22px;border-radius:7px;
      background:linear-gradient(135deg,#ef4444,#f97316);
      display:inline-flex;align-items:center;justify-content:center;
      box-shadow:0 0 0 1px rgba(15,23,42,.8),0 10px 24px rgba(248,113,113,.45);
    }
    header.head p{
      margin-top:6px;font-size:13px;color:var(--muted);
    }

    .layout{
      display:grid;gap:18px;margin-top:10px;
    }
    @media(min-width:880px){
      .layout{
        grid-template-columns: minmax(0,2.2fr) minmax(0,1.4fr);
        align-items:flex-start;
      }
    }

    .card-wrap{
      position:relative;
    }
    .card{
      position:relative;
      border-radius:24px;
      padding:18px 18px 16px;
      overflow:hidden;
      border:1px solid rgba(248,250,252,.1);
      background:
        radial-gradient(circle at 0% 0%,rgba(250,204,21,.2),transparent 55%),
        radial-gradient(circle at 100% 0%,rgba(248,113,113,.22),transparent 55%),
        linear-gradient(145deg,#020617,#020617 55%,#020617 100%);
      box-shadow:0 26px 60px rgba(15,23,42,.95);
    }
    .card::after{
      content:"";
      position:absolute;inset:-40%;
      background:
        radial-gradient(circle at 0% 0%,rgba(250,204,21,.16),transparent 55%),
        radial-gradient(circle at 100% 0%,rgba(248,113,113,.16),transparent 55%);
      opacity:.6;mix-blend-mode:soft-light;pointer-events:none;
    }
    .card-inner{position:relative;z-index:1;display:grid;gap:16px}

    .badge-premium{
      display:inline-flex;align-items:center;gap:6px;
      padding:5px 10px;border-radius:999px;
      background:linear-gradient(90deg,#facc15,#f97316);
      color:#111827;font-size:11px;font-weight:900;letter-spacing:.08em;
      text-transform:uppercase;
      box-shadow:0 12px 30px rgba(248,113,113,.55);
      animation:pulse 2.6s ease-in-out infinite;
    }
    .badge-premium span.ico{font-size:13px}
    @keyframes pulse{
      0%,100%{transform:translateY(0) scale(1)}
      50%{transform:translateY(-1px) scale(1.04)}
    }

    .card-header{
      display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap;
    }
    .holder{
      display:flex;flex-direction:column;gap:1px;font-size:12px;
    }
    .holder strong{font-size:14px;letter-spacing:.03em}
    .holder span.sub{color:var(--muted2);font-size:11px}

    .code-block{
      text-align:right;font-size:11px;
    }
    .code-label{color:var(--muted2);text-transform:uppercase;letter-spacing:.08em}
    .code-value{
      font-family:monospace;
      font-size:16px;font-weight:800;letter-spacing:.25em;
      padding-top:3px;
    }

    .points-row{
      display:flex;justify-content:space-between;align-items:flex-end;gap:12px;flex-wrap:wrap;font-size:13px;
    }
    .points-main span.big{
      font-size:32px;font-weight:900;
      background:linear-gradient(90deg,#facc15,#22c55e);
      -webkit-background-clip:text;color:transparent;
    }
    .points-main small{
      display:block;font-size:11px;color:var(--muted2);text-transform:uppercase;letter-spacing:.08em;
    }
    .points-next{
      text-align:right;font-size:11px;color:var(--muted2);
    }

    .bar-wrap{
      margin-top:8px;
      background:rgba(15,23,42,.9);
      border-radius:999px;
      padding:4px;
      border:1px solid rgba(148,163,184,.5);
      overflow:hidden;
      position:relative;
    }
    .bar-track{
      height:10px;border-radius:999px;
      background:radial-gradient(circle at 0% 0%,rgba(55,65,81,.9),rgba(15,23,42,1));
      overflow:hidden;
    }
    .bar-fill{
      height:100%;border-radius:999px;
      background:linear-gradient(90deg,#f97316,#facc15,#22c55e);
      width:0%;
      position:relative;
      box-shadow:0 0 20px rgba(250,204,21,.65);
      transition:width .6s ease-out;
    }
    .bar-dot{
      position:absolute;right:-6px;top:50%;
      width:14px;height:14px;border-radius:999px;
      background:#facc15;box-shadow:0 0 0 2px rgba(15,23,42,.9),0 0 24px rgba(250,204,21,.85);
      transform:translateY(-50%);
    }
    .bar-text{
      margin-top:6px;font-size:11px;color:var(--muted2);display:flex;justify-content:space-between;
    }

    .actions{
      display:flex;flex-wrap:wrap;gap:8px;margin-top:6px;
    }
    .btn{
      flex:1 1 auto;
      display:inline-flex;align-items:center;justify-content:center;
      padding:9px 12px;border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      background:radial-gradient(circle at 0 0,rgba(15,23,42,1),rgba(15,23,42,.7));
      color:#e5e7eb;font-size:12px;font-weight:600;
      text-decoration:none;cursor:pointer;gap:6px;
      transition:background .2s,border-color .2s,transform .15s,box-shadow .2s;
    }
    .btn span.ico{font-size:13px}
    .btn:hover{
      background:radial-gradient(circle at 0 0,rgba(30,64,175,1),rgba(15,23,42,1));
      border-color:rgba(248,250,252,.8);
      transform:translateY(-1px);
      box-shadow:0 14px 26px rgba(15,23,42,.85);
    }

    .btn-primary{
      border:none;
      background:linear-gradient(90deg,#22c55e,#16a34a);
      color:#022c22;font-weight:800;
      box-shadow:0 16px 32px rgba(22,163,74,.65);
    }
    .btn-primary:hover{
      background:linear-gradient(90deg,#4ade80,#22c55e);
      box-shadow:0 18px 40px rgba(22,163,74,.8);
    }

    .rewards{
      border-radius:18px;
      border:1px solid var(--stroke);
      background:radial-gradient(circle at 0 0,rgba(15,23,42,.9),#020617);
      padding:14px 14px 12px;
      box-shadow:0 18px 40px rgba(15,23,42,.9);
      font-size:13px;
    }
    .rewards h2{
      font-size:14px;font-weight:800;margin-bottom:6px;
      display:flex;justify-content:space-between;align-items:center;
    }
    .rewards h2 span.sub{font-size:11px;color:var(--muted2);font-weight:500}
    .reward-list{
      margin-top:8px;display:grid;gap:6px;
    }
    .reward-item{
      display:flex;justify-content:space-between;align-items:center;gap:8px;
      padding:8px 10px;border-radius:12px;
      border:1px solid rgba(30,64,175,.6);
      background:linear-gradient(120deg,rgba(15,23,42,.98),rgba(15,23,42,.7));
      font-size:12px;
    }
    .reward-item.reached{
      border-color:rgba(34,197,94,.9);
      background:linear-gradient(120deg,rgba(22,163,74,.25),rgba(15,23,42,1));
    }
    .reward-item.next{
      border-color:rgba(250,204,21,.9);
      background:linear-gradient(120deg,rgba(234,179,8,.25),rgba(15,23,42,1));
    }
    .reward-main{display:flex;flex-direction:column;gap:2px}
    .reward-title{font-weight:700}
    .reward-meta{font-size:11px;color:var(--muted2)}
    .reward-threshold{font-size:12px;font-weight:800;white-space:nowrap}

    .badge-tag{
      font-size:10px;text-transform:uppercase;letter-spacing:.08em;
      padding:3px 7px;border-radius:999px;
      border:1px solid rgba(148,163,184,.7);
      color:var(--muted2);
    }

    .section{
      border-radius:18px;
      border:1px solid var(--stroke);
      background:radial-gradient(circle at 0 0,rgba(15,23,42,1),#020617);
      padding:14px 14px 12px;
      box-shadow:0 18px 40px rgba(15,23,42,.9);
      font-size:13px;
    }
    .section h2{
      font-size:14px;font-weight:800;margin-bottom:6px;
      display:flex;align-items:center;justify-content:space-between;gap:8px;
    }
    .section h2 button.toggle-link{
      border:none;background:transparent;
      color:var(--muted2);font-size:11px;cursor:pointer;
      display:inline-flex;align-items:center;gap:4px;
    }
    .section h2 button.toggle-link span.ico{font-size:11px}
    .section-body{margin-top:8px;font-size:12px;color:var(--muted);}
    .section-body ul{list-style:none;display:grid;gap:4px;margin-top:4px}
    .section-body li{display:flex;justify-content:space-between;gap:8px}
    .section-body li span.points{font-weight:700;color:#facc15}

    .section-body.collapsed{display:none}

    .toast{
      position:fixed;left:50%;bottom:20px;
      transform:translateX(-50%);
      padding:8px 12px;border-radius:999px;
      background:rgba(15,23,42,.98);
      border:1px solid rgba(248,250,252,.4);
      font-size:12px;color:#e5e7eb;
      box-shadow:0 18px 40px rgba(15,23,42,.9);
      opacity:0;pointer-events:none;transition:opacity .2s;
      z-index:50;
    }
    .toast.show{opacity:1}

    /* FLOW: registrati / amico */
    .flow{
      display:none;
      border-radius:18px;
      border:1px solid var(--stroke);
      background:radial-gradient(circle at 0 0,rgba(15,23,42,1),#020617);
      padding:16px 16px 14px;
      box-shadow:0 20px 46px rgba(15,23,42,.95);
      font-size:13px;
    }
    .flow h2{
      font-size:16px;font-weight:800;margin-bottom:6px;
      display:flex;align-items:center;gap:6px;
    }
    .flow h2 span.ico{font-size:16px}
    .flow p.lead{font-size:12px;color:var(--muted);margin-bottom:10px}
    .field{
      display:flex;flex-direction:column;gap:4px;margin-bottom:8px;
    }
    .field label{font-size:11px;color:var(--muted2);text-transform:uppercase;letter-spacing:.08em}
    .field input{
      padding:8px 10px;border-radius:10px;
      border:1px solid rgba(55,65,81,.9);
      background:rgba(15,23,42,.9);color:#e5e7eb;font-size:13px;
    }
    .flow small.helper{font-size:11px;color:var(--muted2);display:block;margin-top:4px}
    .flow .btn-primary{margin-top:6px}

    @media(max-width:600px){
      header.head h1{font-size:18px}
      .card{padding:16px}
      .points-row span.big{font-size:26px}
    }
  </style>
</head>
<body>
  <div class="shell">
    <header class="head">
      <h1>
        <span class="logo">üëë</span>
        Fidelity Card Re Long
      </h1>
      <p>Accumula punti con ogni servizio e sblocca premi reali in negozio.</p>
    </header>

    <div class="layout">
      <!-- VISTA CARD DIGITALE -->
      <div id="card-view" class="card-wrap">
        <div class="card">
          <div class="card-inner">
            <div class="card-header">
              <div class="holder">
                <span class="badge-premium"><span class="ico">‚ú®</span> Fidelity Premium</span>
                <strong id="holder-name">Cliente Re Long</strong>
                <span class="sub">Marano di Napoli ‚Ä¢ Via Casalanno 31</span>
              </div>
              <div class="code-block">
                <div class="code-label">Codice Invito</div>
                <div class="code-value" id="invite-code">XXXXXX</div>
              </div>
            </div>

            <div class="points-row">
              <div class="points-main">
                <span class="big" id="points-total">0</span>
                <small>Punti disponibili</small>
              </div>
              <div class="points-next" id="points-next">
                Prossimo premio a <b>150</b> punti
              </div>
            </div>

            <div class="bar-wrap">
              <div class="bar-track">
                <div class="bar-fill" id="bar-fill">
                  <div class="bar-dot"></div>
                </div>
              </div>
              <div class="bar-text">
                <span id="bar-label-left">Inizio percorso</span>
                <span id="bar-label-right">0 / 150 punti</span>
              </div>
            </div>

            <div class="actions">
              <button class="btn btn-primary" id="btn-invita">
                <span class="ico">üì≤</span>
                Porta un amico
              </button>
              <button class="btn" id="btn-come">
                <span class="ico">üìà</span>
                Come accumulo punti?
              </button>
            </div>
          </div>
        </div>

        <div class="rewards" style="margin-top:12px">
          <h2>
            Premi disponibili
            <span class="sub">Mostriamo cosa hai gi√† sbloccato e cosa ti manca.</span>
          </h2>
          <div class="reward-list" id="reward-list"></div>
        </div>
      </div>

      <!-- PANNELLO DESTRO: COME ACCUMULO + FLOW -->
      <div style="display:grid;gap:12px">
        <!-- COME ACCUMULARE PUNTI -->
        <section class="section">
          <h2>
            Come accumulare punti
            <button type="button" class="toggle-link" id="toggle-come">
              <span class="ico">‚ñæ</span> Mostra / Nascondi
            </button>
          </h2>
          <div class="section-body collapsed" id="come-body">
            <p>Per ogni servizio Re Long, ottieni punti sulla tua Fidelity Card:</p>
            <ul>
              <li><span>Riparazione Computer</span><span class="points">+50 pt</span></li>
              <li><span>Riparazione Smartphone</span><span class="points">+25 pt</span></li>
              <li><span>Kit 4 cartucce compatibili</span><span class="points">+5 pt</span></li>
              <li><span>Toner compatibili</span><span class="points">+10 pt</span></li>
              <li><span>Linea Fissa attivata</span><span class="points">+80 pt</span></li>
              <li><span>SIM attivata</span><span class="points">+30 pt</span></li>
              <li><span>Offerta Energia attivata</span><span class="points">+100 pt</span></li>
              <li><span>Porta un amico (chi presenta)</span><span class="points">+80 pt</span></li>
              <li><span>Porta un amico (chi si iscrive)</span><span class="points">+40 pt</span></li>
            </ul>
          </div>
        </section>

        <!-- FLOW: REGISTRAZIONE / PORTA UN AMICO -->
        <section class="flow" id="flow-registrati">
          <h2><span class="ico">üìù</span> Registrati alla Fidelity Re Long</h2>
          <p class="lead">
            Compila i tuoi dati e invieremo una richiesta diretta a Re Long su WhatsApp per creare la tua Fidelity Card.
          </p>
          <form id="form-registrati">
            <div class="field">
              <label for="reg-name">Nome e Cognome</label>
              <input id="reg-name" required placeholder="Mario Rossi">
            </div>
            <div class="field">
              <label for="reg-phone">Telefono</label>
              <input id="reg-phone" required placeholder="3331234567" inputmode="numeric">
            </div>
            <small class="helper">Verrai contattato da Re Long per conferma e rilascio della tua card digitale.</small>
            <button type="submit" class="btn btn-primary">
              üì≤ Invia richiesta su WhatsApp
            </button>
          </form>
        </section>

        <section class="flow" id="flow-amico">
          <h2><span class="ico">ü§ù</span> Porta un amico / Iscriviti con un codice</h2>
          <p class="lead">
            Hai ricevuto un codice invito Fidelity da un amico? Inseriscilo qui insieme ai tuoi dati.
          </p>
          <form id="form-amico">
            <div class="field">
              <label for="amico-code">Codice amico</label>
              <input id="amico-code" required placeholder="ES: A1B2C3" maxlength="10">
            </div>
            <div class="field">
              <label for="amico-name">Il tuo Nome e Cognome</label>
              <input id="amico-name" required placeholder="Giulia Bianchi">
            </div>
            <div class="field">
              <label for="amico-phone">Il tuo Telefono</label>
              <input id="amico-phone" required placeholder="3331234567" inputmode="numeric">
            </div>
            <small class="helper">
              Re Long assegner√† automaticamente i punti:
              <br>‚Ä¢ <b>80 punti</b> a chi ti ha invitato
              <br>‚Ä¢ <b>40 punti</b> a te sulla nuova Fidelity Card
            </small>
            <button type="submit" class="btn btn-primary">
              üì≤ Invia richiesta su WhatsApp
            </button>
          </form>
        </section>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Copiato negli appunti</div>

  <script>
    const HUB_URL = "https://alessandroiascone.github.io/relong-nfc/relong-hub-v2.html";
    const STORE_PHONE = "3908119578844"; // per WhatsApp negozio
    const STORAGE_KEY = "relong-fidelity-points-v1";

    const rewards = [
      { threshold:150, label:"Pellicola di gel Ultra Crystal Premium Quality" },
      { threshold:300, label:"Powerbank 5000mAh First Rapid Charge" },
      { threshold:600, label:"Cuffie Bluetooth SGS Pods" },
      { threshold:1000,label:"Smartwatch SGS Square BT con chiamata" },
      { threshold:1500,label:"Occhiali SGS Smart con musica & chiamate" }
    ];

    function showToast(msg){
      const t=document.getElementById('toast');
      t.textContent=msg||"Azioni completata";
      t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'),1800);
    }

    function getParams(){
      const p=new URLSearchParams(location.search);
      return {
        id: p.get("id"),
        mode: p.get("mode")
      };
    }

    function normalizeId(id){
      if(!id) return "demo";
      return String(id);
    }

    function loadPoints(){
      try{
        const raw=localStorage.getItem(STORAGE_KEY);
        if(!raw) return {};
        const obj=JSON.parse(raw);
        return obj && typeof obj==="object" ? obj : {};
      }catch(e){return {}}
    }
    function savePoints(map){
      try{localStorage.setItem(STORAGE_KEY,JSON.stringify(map));}catch(e){}
    }

    function initCard(cardId){
      const id = normalizeId(cardId);
      const ptsMap = loadPoints();
      if(typeof ptsMap[id] !== "number") ptsMap[id]=0;
      const points = ptsMap[id];

      const holderName = document.getElementById("holder-name");
      const codeEl = document.getElementById("invite-code");
      const totalEl = document.getElementById("points-total");
      const nextEl  = document.getElementById("points-next");
      const barFill = document.getElementById("bar-fill");
      const barRight= document.getElementById("bar-label-right");
      const rewardList = document.getElementById("reward-list");

      // Nome: se abbiamo salvato qualcosa in locale lo usiamo, altrimenti generico
      const storedNameKey = "relong-fidelity-name-" + id;
      const storedName = localStorage.getItem(storedNameKey);
      holderName.textContent = storedName || "Cliente Re Long";

      // Codice invito deterministico dalle ultime 6 cifre dell'id
      let rawCode = id.replace(/\D/g,"");
      if(rawCode.length < 6){
        rawCode = (rawCode + "000000").slice(-6);
      } else {
        rawCode = rawCode.slice(-6);
      }
      const code = rawCode.toUpperCase();
      codeEl.textContent = code.replace(/(.{3})/g,"$1 ").trim();

      totalEl.textContent = points;

      // Calcolo prossimo reward
      let nextReward = rewards.find(r=> points < r.threshold);
      let prevThreshold = 0;
      if(!nextReward){
        nextReward = rewards[rewards.length-1];
        prevThreshold = nextReward.threshold;
      }else{
        const idx = rewards.indexOf(nextReward);
        prevThreshold = idx>0 ? rewards[idx-1].threshold : 0;
      }
      nextEl.innerHTML = points >= rewards[rewards.length-1].threshold
        ? "Hai raggiunto l'ultimo premio disponibile!"
        : `Prossimo premio a <b>${nextReward.threshold}</b> punti`;

      // Progress %
      const spanTotal = nextReward.threshold - prevThreshold || 1;
      const spanDone = Math.min(points - prevThreshold, spanTotal);
      let perc = Math.max(0, Math.min(100, (spanDone/spanTotal)*100));
      barFill.style.width = perc + "%";
      barRight.textContent = `${points} / ${nextReward.threshold} punti`;

      // Lista premi
      rewardList.innerHTML="";
      rewards.forEach(r=>{
        const item=document.createElement("div");
        item.className="reward-item";
        if(points >= r.threshold) item.classList.add("reached");
        else if(!rewardList.querySelector(".next") && points < r.threshold) item.classList.add("next");

        const main=document.createElement("div");
        main.className="reward-main";
        const title=document.createElement("div");
        title.className="reward-title";
        title.textContent=r.label;
        const meta=document.createElement("div");
        meta.className="reward-meta";

        if(points >= r.threshold){
          meta.textContent="Premio raggiunto ‚Ä¢ Ritiralo in negozio";
        }else if(points < r.threshold){
          const diff = r.threshold - points;
          if(diff <= 50){
            meta.textContent=`Ti mancano solo ${diff} punti`;
          }else{
            meta.textContent=`Ancora ${diff} punti per sbloccarlo`;
          }
        }

        main.appendChild(title);
        main.appendChild(meta);

        const right=document.createElement("div");
        right.style.textAlign="right";
        const th=document.createElement("div");
        th.className="reward-threshold";
        th.textContent=r.threshold+" pt";

        const tag=document.createElement("div");
        tag.className="badge-tag";
        if(points >= r.threshold){
          tag.textContent="Sbloccato";
        }else{
          tag.textContent = (r.threshold === nextReward.threshold) ? "Prossimo premio" : "Prossimo step";
        }
        right.appendChild(th);
        right.appendChild(tag);

        item.appendChild(main);
        item.appendChild(right);
        rewardList.appendChild(item);
      });

      // Porta un amico (codice + WhatsApp)
      const btnInvita=document.getElementById("btn-invita");
      btnInvita.onclick=()=>{
        const msg = `Ti invito alla Fidelity Card Re Long üéÅ\n`+
          `Usa questo codice per iscriverti: ${code}\n`+
          `Iscriviti da qui o chiedi info: ${HUB_URL}`;
        try{ navigator.clipboard.writeText(code); showToast("Codice invito copiato"); }catch(e){ showToast("Codice: "+code); }
        const url = "https://wa.me/?text="+encodeURIComponent(msg);
        window.open(url,"_blank","noopener");
      };
    }

    function initComeSection(){
      const btn=document.getElementById("btn-come");
      const toggle=document.getElementById("toggle-come");
      const body=document.getElementById("come-body");
      const toggleFn=()=>{
        body.classList.toggle("collapsed");
      };
      btn.addEventListener("click",toggleFn);
      toggle.addEventListener("click",toggleFn);
    }

    function initFlows(mode){
      const reg=document.getElementById("flow-registrati");
      const ami=document.getElementById("flow-amico");
      reg.style.display="none";
      ami.style.display="none";

      if(mode==="registrati" || mode==="iscriviti"){
        reg.style.display="block";
      }else if(mode==="amico"){
        ami.style.display="block";
      }
    }

    function initForms(){
      const regForm=document.getElementById("form-registrati");
      const amiForm=document.getElementById("form-amico");

      if(regForm){
        regForm.addEventListener("submit",e=>{
          e.preventDefault();
          const name=document.getElementById("reg-name").value.trim();
          const phone=document.getElementById("reg-phone").value.trim();
          if(!name || !phone) return;
          const text=
`Nuova richiesta Fidelity Card Re Long üßæ
Nome: ${name}
Telefono: ${phone}
Provenienza: Registrazione dal sito / HUB.

Attribuire 40 punti di benvenuto.`;
          const url=`https://wa.me/${STORE_PHONE}?text=${encodeURIComponent(text)}`;
          window.location.href=url;
        });
      }

      if(amiForm){
        amiForm.addEventListener("submit",e=>{
          e.preventDefault();
          const code=document.getElementById("amico-code").value.trim();
          const name=document.getElementById("amico-name").value.trim();
          const phone=document.getElementById("amico-phone").value.trim();
          if(!code || !name || !phone) return;
          const text=
`Nuova iscrizione Fidelity - Porta un amico ü§ù

Nuovo cliente:
‚Ä¢ Nome: ${name}
‚Ä¢ Telefono: ${phone}

Codice amico utilizzato: ${code}

Punti da assegnare:
‚Ä¢ 80 pt al cliente con codice: ${code}
‚Ä¢ 40 pt al nuovo iscritto.`;
          const url=`https://wa.me/${STORE_PHONE}?text=${encodeURIComponent(text)}`;
          window.location.href=url;
        });
      }
    }

    (function boot(){
      const {id,mode} = getParams();

      // Card view sempre visibile (per i link con id)
      if(id){
        initCard(id);
      }else{
        initCard("demo");
      }

      initComeSection();
      initForms();

      // Flussi dal HUB (registrati / amico)
      if(mode){
        initFlows(mode);
      }
    })();
  </script>
</body>
</html>
