<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Catalogo Smartphone 3D | Re Long</title>
<meta name="theme-color" content="#0a0a0a" />

<style>
  :root{
    --bg1:#0a0a0a; --bg2:#000; --card:#151515; --stroke:#2b2b2b;
    --grad:linear-gradient(90deg,#ff0000,#ff7b00);
    --muted:rgba(255,255,255,.72);
    --wa1:#ff0000; --wa2:#ff7b00; --wa3:#ffd166;
    --focus:#ffd166; --yellow:#ffd166;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,Inter,Roboto,sans-serif; color:#fff;
    background:radial-gradient(circle at 20% 20%, var(--bg1) 0%, var(--bg2) 70%);
    overflow-x:hidden;
  }

  /* spotlight */
  .spotlight{
    position:fixed; inset:auto; left:var(--x,50%); top:var(--y,40%);
    width:1100px; height:1100px; transform:translate(-50%,-50%);
    pointer-events:none; z-index:0; border-radius:50%;
    background:radial-gradient(closest-side, rgba(255,120,0,.10), rgba(0,0,0,0) 65%);
    filter:blur(8px);
  }

  /* 3D title */
  header{
    position:relative; z-index:1; text-align:center; padding:22px 16px 10px;
  }
  h1{
    margin:0 0 6px;
    font-size:26px; letter-spacing:-.02em; font-weight:900;
    text-shadow:
      0 1px 0 rgba(0,0,0,.5),
      0 2px 0 rgba(0,0,0,.45),
      0 3px 0 rgba(0,0,0,.4),
      0 12px 28px rgba(0,0,0,.55),
      0 0 24px rgba(255,90,0,.12);
    background:var(--grad); -webkit-background-clip:text; color:transparent;
  }
  .sub{font-size:13px; color:var(--muted)}
  .wrap{position:relative; z-index:1; max-width:1200px; margin:0 auto; padding:10px 14px 40px}

  /* FILTRI BRAND (sticky) */
  .filters-wrap{
    position:sticky; top:8px; z-index:10;
    background:rgba(10,10,10,.6); backdrop-filter:saturate(1.1) blur(6px);
    border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:10px;
  }
  .filters{display:flex; gap:10px; overflow-x:auto; padding:2px}
  .filters button{
    background:#111; border:1px solid #333; color:#fff; padding:10px 16px; border-radius:999px;
    font-weight:900; white-space:nowrap; cursor:pointer;
    text-shadow:0 1px 0 rgba(0,0,0,.5);
  }
  .filters button.active{
    background:linear-gradient(90deg,#ff0000,#ff7b00);
    color:#000; border-color:transparent;
    box-shadow:0 14px 30px rgba(255,90,0,.35);
  }

  /* GRID */
  .grid{
    display:grid; gap:20px; margin-top:18px;
    grid-template-columns:repeat(auto-fill,minmax(240px,1fr))
  }

  /* CARD 3D */
  .card{
    position:relative;
    background:linear-gradient(150deg, rgba(20,20,20,.96), rgba(0,0,0,.62));
    border:1px solid var(--stroke); border-radius:16px; padding:14px;
    box-shadow:
      0 26px 60px rgba(0,0,0,.9),
      0 0 60px rgba(255,0,0,.12);
    border-top:1px solid rgba(255,255,255,.06);
    transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease, filter .18s ease;
    transform-style:preserve-3d; will-change:transform, box-shadow;
    opacity:0; transform:translateY(14px);
  }
  .card.in{opacity:1; transform:none}
  .card::after{ /* sheen */
    content:""; position:absolute; inset:-1px; border-radius:16px; pointer-events:none;
    background:radial-gradient(800px 180px at 50% -10%, rgba(255,140,0,.17), transparent 60%);
    opacity:.0; transition:opacity .2s ease; filter:blur(8px);
  }
  .card:hover{
    transform:perspective(900px) rotateX(2deg) rotateY(-2deg) translateZ(5px);
    box-shadow:0 38px 90px rgba(0,0,0,.92), 0 0 90px rgba(255,59,0,.22);
    border-color:rgba(255,255,255,.18);
  }
  .card:hover::after{opacity:1}

  .img{
    width:100%; aspect-ratio:4/5; border-radius:12px; background:#000; object-fit:cover; margin-bottom:12px;
    box-shadow:0 14px 30px rgba(0,0,0,.6) inset;
  }

  /* BRAND RIBBON */
  .brand-tag{
    position:absolute; top:12px; left:-6px;
    padding:6px 12px 6px 16px; border-radius:0 10px 10px 0;
    background:linear-gradient(90deg,#ff0000,#ff7b00);
    color:#000; font-weight:900; font-size:11px; letter-spacing:.02em;
    box-shadow:0 10px 24px rgba(255,90,0,.35);
    text-shadow:0 1px 0 rgba(255,255,255,.4);
    border:1px solid rgba(0,0,0,.15);
  }

  /* BADGE (novitÃ /promo/top) */
  .badge{
    position:absolute; top:-10px; right:12px; padding:6px 10px; border-radius:999px;
    font-size:11px; font-weight:900; color:#000; border:1px solid rgba(0,0,0,.06);
    box-shadow:0 10px 18px rgba(255,80,0,.35);
  }
  .badge.novita{background:linear-gradient(90deg,#ff006e,#ffbe0b)}
  .badge.promo {background:linear-gradient(90deg,#00b4d8,#0077b6)}
  .badge.top   {background:linear-gradient(90deg,#7209b7,#4361ee)}

  /* TEXT 3D */
  .name{
    font-weight:900; letter-spacing:-.01em;
    text-shadow:
      0 1px 0 rgba(0,0,0,.55),
      0 12px 26px rgba(0,0,0,.45);
  }
  .brand{font-size:12px; color:var(--muted); margin:2px 0 6px}
  .price{
    font-size:20px; font-weight:900; background:var(--grad); -webkit-background-clip:text; color:transparent; margin:6px 0 0;
    text-shadow:0 10px 22px rgba(255,90,0,.12);
  }

  /* RATE */
  .rate{margin-top:10px; background:#101010; border:1px solid #2b2b2b; border-radius:12px; padding:10px}
  .rate label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
  .rate select{width:100%; padding:10px 12px; border-radius:10px; border:1px solid #3a3a3a; background:#000; color:#fff}
  .rata{
    font-size:14px; margin-top:8px; font-weight:900;
    color:var(--yellow); /* âœ… giallo evidente */
    text-shadow:0 0 18px rgba(255,209,102,.18);
  }

  /* CTA aggressivo rossoâ†’arancioâ†’giallo */
  .wa{
    display:block; margin-top:12px; text-align:center; padding:12px; border-radius:12px;
    font-weight:900; text-decoration:none; color:#000;
    background:linear-gradient(45deg, var(--wa1), var(--wa2) 55%, var(--wa3));
    box-shadow:0 18px 34px rgba(255,120,0,.45), 0 2px 6px rgba(0,0,0,.6) inset;
    text-shadow:0 1px 0 rgba(255,255,255,.7);
    border:1px solid rgba(0,0,0,.15);
  }

  /* INFO */
  .status{margin-top:12px; font-size:13px; color:var(--muted); text-align:center}
  .error{max-width:900px; margin:16px auto 0; background:#161616; border:1px solid #333; padding:14px; border-radius:12px}
  .error b{color:#fff}

  :focus-visible{outline:3px solid var(--focus); outline-offset:2px; border-radius:10px}
</style>
</head>
<body>

<!-- spotlight -->
<div class="spotlight" aria-hidden="true"></div>

<header>
  <h1>Catalogo Smartphone 3D</h1>
  <div class="sub">Scegli, calcola la rata e invia il preventivo su WhatsApp</div>
</header>

<div class="wrap">

  <!-- SOLO FILTRO BRAND -->
  <div class="filters-wrap">
    <div id="filters" class="filters" aria-label="Filtri brand"></div>
  </div>

  <div id="status" class="status">Carico i prodottiâ€¦</div>
  <div id="grid" class="grid" aria-live="polite"></div>
</div>

<script>
/* ===== Config ===== */
const WA = "https://wa.me/3908119578844?text=";
const DATA_URL = "./prodotti.json";

/* ===== Util ===== */
const money = n => Number(n).toLocaleString('it-IT',{minimumFractionDigits:2,maximumFractionDigits:2});
const norm = s => (s||"").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");

/* ===== Spotlight mouse ===== */
(function(){
  const sp = document.querySelector('.spotlight');
  if(!sp) return;
  const upd = (e)=>{
    const x = e.clientX || innerWidth/2;
    const y = e.clientY || innerHeight*0.4;
    sp.style.setProperty('--x', x+'px');
    sp.style.setProperty('--y', y+'px');
  };
  window.addEventListener('mousemove', upd, {passive:true});
  upd({clientX: innerWidth/2, clientY: innerHeight*0.4});
})();

/* ===== Render Card ===== */
function renderCard(p, idx){
  const badge =
    p.novita ? 'novita' :
    p.promo  ? 'promo'  :
    p.top    ? 'top'    : '';

  const selId = `rate-${idx}`;
  const waId  = `wa-${idx}`;

  const baseMsg = `Preventivo per ${p.nome}\nPrezzo totale: â‚¬ ${money(p.prezzo)}`;

  return `
  <article class="card" data-brand="${p.brand}" data-name="${norm(p.nome)}" data-price="${Number(p.prezzo)}">
    <span class="brand-tag">${p.brand}</span>
    ${badge ? `<span class="badge ${badge}">${badge.toUpperCase()}</span>` : ``}

    <img class="img" src="${p.img}" alt="${p.nome}" onerror="this.style.opacity=.35;this.title='Immagine non trovata: ${p.img}'">

    <div class="name">${p.nome}</div>
    <div class="brand">${p.brand}</div>
    <div class="price">â‚¬ ${money(p.prezzo)}</div>

    <div class="rate">
      <label for="${selId}">Rate mensili</label>
      <select id="${selId}" onchange="onRateChange(this, ${Number(p.prezzo)}, '${encodeURIComponent(p.nome)}', '${waId}')">
        <option value="">â€” seleziona â€”</option>
        <option value="12">12 mesi</option>
        <option value="24">24 mesi</option>
        <option value="30">30 mesi</option>
        <option value="36">36 mesi</option>
        <option value="48">48 mesi</option>
      </select>
      <div class="rata" aria-live="polite"></div>
    </div>

    <a id="${waId}" class="wa" href="${WA + encodeURIComponent(baseMsg)}" target="_blank" rel="noopener">
      Invia preventivo ðŸ“²
    </a>
  </article>`;
}

/* ===== Update rata + link WA ===== */
function onRateChange(sel, prezzo, nomeEnc, waId){
  const mesi = parseInt(sel.value || 0, 10);
  const box  = sel.parentElement.querySelector('.rata');
  const btn  = document.getElementById(waId);
  const nome = decodeURIComponent(nomeEnc);

  let msg = `Preventivo per ${nome}\nPrezzo totale: â‚¬ ${money(prezzo)}`;

  if(!mesi){
    box.textContent = '';
    btn.href = WA + encodeURIComponent(msg);
    return;
  }

  const rata = prezzo / mesi;
  box.textContent = `Rata mensile: â‚¬ ${money(rata)} / mese (${mesi} mesi)`;

  msg += `\n\nRate: ${mesi} mesi`;
  msg += `\nRata mensile: â‚¬ ${money(rata)}/mese`;
  msg += `\n\nRichiedo un preventivo dettagliato.`;

  btn.href = WA + encodeURIComponent(msg);
}

/* ===== Stato ===== */
let ALL = [];
let CURRENT_BRAND = 'all';

/* ===== Init ===== */
(async function init(){
  const status = document.getElementById('status');
  const grid   = document.getElementById('grid');
  const filters= document.getElementById('filters');

  try{
    const res = await fetch(DATA_URL + '?v=' + Date.now(), {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP ' + res.status);
    ALL = await res.json();

    renderGrid(ALL);
    status.textContent = `Prodotti: ${ALL.length}`;

    // filtri brand
    const brands = ['all', ...new Set(ALL.map(p=>p.brand))];
    filters.innerHTML = brands.map(b=>`
      <button data-b="${b}" onclick="filterBrand('${b}')">${b==='all'?'Tutti':b}</button>
    `).join('');
    const first = filters.querySelector('button'); if(first) first.classList.add('active');

  }catch(err){
    document.querySelector('.wrap').insertAdjacentHTML('afterbegin',
      `<div class="error"><b>Impossibile caricare i prodotti.</b><br>
       Assicurati che <code>prodotti.json</code> sia nella stessa cartella di questa pagina e che le immagini esistano in <code>/imgcatalogo/</code>.<br>
       Errore: ${err.message}</div>`
    );
    status.textContent = 'Errore caricamento';
  }

  // fade-in on scroll
  const obs = new IntersectionObserver((entries)=>{
    entries.forEach(en=>{ if(en.isIntersecting){ en.target.classList.add('in'); obs.unobserve(en.target); } });
  }, {threshold:.16});
  grid.querySelectorAll('.card').forEach(el=>obs.observe(el));

  // micro tilt
  grid.addEventListener('pointermove', (e)=>{
    const card = e.target.closest('.card'); if(!card) return;
    const r = card.getBoundingClientRect();
    const cx = (e.clientX - r.left)/r.width - .5;
    const cy = (e.clientY - r.top)/r.height - .5;
    card.style.transform = `perspective(900px) rotateX(${(-cy*4).toFixed(2)}deg) rotateY(${(cx*4).toFixed(2)}deg) translateZ(5px)`;
  });
  grid.addEventListener('pointerleave', ()=>{
    grid.querySelectorAll('.card').forEach(c=>c.style.transform='');
  });
})();

/* ===== Helpers ===== */
function renderGrid(list){
  const grid = document.getElementById('grid');
  grid.innerHTML = list.map((p,i)=>renderCard(p,i)).join('');
}

function filterBrand(b){
  CURRENT_BRAND = b;
  document.querySelectorAll('.filters button').forEach(btn=>btn.classList.remove('active'));
  const cur = document.querySelector(`.filters button[data-b="${b}"]`);
  if(cur) cur.classList.add('active');

  const list = (b==='all') ? ALL : ALL.filter(p=>p.brand===b);
  renderGrid(list);
}
</script>
</body>
</html>
