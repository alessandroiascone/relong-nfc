<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Catalogo Smartphone a Rate | Re Long</title>
<meta name="theme-color" content="#0a0a0a" />

<style>
  :root{
    --bg1:#0a0a0a; --bg2:#000;
    --card:rgba(20,20,20,.94); --stroke:rgba(255,255,255,.08);
    --grad:linear-gradient(90deg,#ff0000,#ff7b00);
    --muted:rgba(255,255,255,.72);
    --muted2:rgba(255,255,255,.5);
    --yel:#ffd166;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,Inter,Roboto,sans-serif; color:#fff;
    background:radial-gradient(circle at 20% 20%,var(--bg1) 0%,var(--bg2) 70%);
  }

  /* Header */
  .topbar{
    position:sticky; top:0; z-index:50;
    background:linear-gradient(90deg,rgba(10,10,10,.9),rgba(0,0,0,.85));
    border-bottom:1px solid var(--stroke);
    backdrop-filter:saturate(1.2) blur(6px);
    display:flex; gap:10px; align-items:center; justify-content:space-between;
    padding:10px 14px;
  }
  .back{
    text-decoration:none; color:#fff; font-weight:800; font-size:13px;
    padding:8px 12px; border-radius:999px; border:1px solid var(--stroke); background:#111;
  }
  .back:hover{background:#151515}
  .title{
    font-weight:900; letter-spacing:-.02em; text-align:center; margin:0 auto;
    background:var(--grad); -webkit-background-clip:text; color:transparent; font-size:18px;
  }

  .wrap{max-width:1200px; margin:0 auto; padding:14px}

  /* Filtri (pill) */
  .filters{display:flex; gap:10px; overflow-x:auto; padding:10px 2px 2px}
  .filters button{
    background:#111; border:1px solid #333; color:#fff; padding:9px 16px;
    border-radius:999px; font-weight:900; white-space:nowrap; cursor:pointer
  }
  .filters button.active{
    background:var(--grad); color:#000; border-color:transparent;
    box-shadow:0 12px 28px rgba(255,90,0,.35)
  }

  /* Grid + Card (stile dark-3D v3) */
  .grid{
    display:grid; gap:18px; margin-top:16px;
    grid-template-columns:repeat(auto-fill,minmax(240px,1fr))
  }
  .card{
    position:relative;
    background:linear-gradient(150deg,var(--card) 0%,rgba(0,0,0,.6) 100%);
    border:1px solid var(--stroke); border-radius:18px; padding:14px;
    box-shadow:0 24px 56px rgba(0,0,0,.9), 0 0 60px rgba(255,0,0,.14);
    transition:transform .22s ease, box-shadow .22s ease, border-color .22s ease;
    transform-style:preserve-3d;
  }
  .card:hover{
    transform:perspective(900px) rotateX(2deg) rotateY(-2deg) translateZ(6px);
    box-shadow:0 36px 84px rgba(0,0,0,.92), 0 0 90px rgba(255,59,0,.22);
    border-color:rgba(255,255,255,.18);
  }
  .img{width:100%; aspect-ratio:4/5; border-radius:12px; background:#000; object-fit:cover; margin-bottom:10px}

  /* Banner brand e badge */
  .brand-tag{
    position:absolute; top:12px; left:-6px;
    padding:6px 12px 6px 16px; border-radius:0 10px 10px 0;
    background:var(--grad); color:#000; font-weight:900; font-size:11px; letter-spacing:.02em;
    box-shadow:0 10px 24px rgba(255,90,0,.35); border:1px solid rgba(0,0,0,.06);
  }
  .badge{
    position:absolute; top:-10px; right:12px;
    padding:6px 10px; border-radius:999px; font-size:11px; font-weight:900; color:#000;
    border:1px solid rgba(0,0,0,.06); box-shadow:0 10px 18px rgba(255,80,0,.35)
  }
  .badge.novita{background:linear-gradient(90deg,#ff006e,#ffbe0b)}
  .badge.promo {background:linear-gradient(90deg,#00b4d8,#0077b6)}
  .badge.top   {background:linear-gradient(90deg,#7209b7,#4361ee)}

  /* Testi card */
  .name{font-weight:900; letter-spacing:-.01em}
  .brand{font-size:12px; color:var(--muted); margin:2px 0 6px}
  .price{font-size:20px; font-weight:900; background:var(--grad); -webkit-background-clip:text; color:transparent; margin:6px 0 0}

  /* Rate */
  .rate{margin-top:10px; background:#101010; border:1px solid #2b2b2b; border-radius:12px; padding:10px}
  .rate label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
  .rate select{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid #3a3a3a; background:#000; color:#fff; font-weight:700
  }
  .rata{font-size:14px; margin-top:8px; font-weight:900; color:var(--yel); text-shadow:0 0 18px rgba(255,209,102,.18)}

  /* WhatsApp CTA (rossoâ†’arancioâ†’giallo) */
  .wa{
    display:block; margin-top:12px; text-align:center; padding:12px; border-radius:12px;
    font-weight:900; text-decoration:none; color:#000;
    background:linear-gradient(45deg,#ff0000,#ff7b00 55%,#ffd166);
    box-shadow:0 18px 34px rgba(255,120,0,.45);
  }

  .status{margin-top:12px; font-size:13px; color:var(--muted2); text-align:center}
  .error{max-width:900px; margin:16px auto 0; background:#161616; border:1px solid #333; padding:14px; border-radius:12px}
  .error b{color:#fff}
</style>
</head>
<body>

<!-- Torna allâ€™HUB -->
<div class="topbar">
  <a class="back" href="./relong-hub-v2.html" aria-label="Torna allâ€™HUB">â¬…ï¸Ž HUB</a>
  <div class="title">Catalogo Smartphone a Rate</div>
  <span style="width:54px"></span>
</div>

<div class="wrap">
  <div id="status" class="status">Carico i prodottiâ€¦</div>
  <div id="filters" class="filters" aria-label="Filtri brand"></div>
  <div id="grid" class="grid" aria-live="polite"></div>
</div>

<script>
/* ===== Config ===== */
const WA = "https://wa.me/3908119578844?text=";
const DATA_URL = "./prodotti.json";   // stesso path della pagina
const IMG_DIR  = "./imgcatalogo/";    // cartella immagini

/* ===== Util ===== */
const money = n => Number(n).toLocaleString('it-IT',{minimumFractionDigits:2,maximumFractionDigits:2});

/* ===== Render Card ===== */
function renderCard(p, idx){
  const badge = p.novita ? 'novita' : p.promo ? 'promo' : p.top ? 'top' : '';
  const selId = `rate-${idx}`;
  const waId  = `wa-${idx}`;
  const imgSrc = IMG_DIR + (p.img || "");

  const baseMsg =
`Preventivo per ${p.nome}
Prezzo totale: â‚¬ ${money(p.prezzo)}`;

  return `
  <article class="card" data-brand="${p.brand}">
    <span class="brand-tag">${p.brand}</span>
    ${badge ? `<span class="badge ${badge}">${badge.toUpperCase()}</span>` : ``}

    <img class="img" src="${imgSrc}" alt="${p.nome}" onerror="this.style.opacity=.35;this.title='Immagine non trovata: ${imgSrc}'">

    <div class="name">${p.nome}</div>
    <div class="brand">${p.brand}</div>
    <div class="price">â‚¬ ${money(p.prezzo)}</div>

    <div class="rate">
      <label for="${selId}">Rate mensili</label>
      <select id="${selId}" onchange="onRateChange(this, ${Number(p.prezzo)}, '${encodeURIComponent(p.nome)}', '${waId}')">
        <option value="">â€” seleziona â€”</option>
        <option value="12">12 mesi</option>
        <option value="24">24 mesi</option>
        <option value="30">30 mesi</option>
        <option value="36">36 mesi</option>
        <option value="48">48 mesi</option>
      </select>
      <div class="rata" aria-live="polite"></div>
    </div>

    <a id="${waId}" class="wa" href="${WA + encodeURIComponent(baseMsg)}" target="_blank" rel="noopener">
      Invia preventivo ðŸ“²
    </a>
  </article>`;
}

/* ===== Update rata + link WA ===== */
function onRateChange(sel, prezzo, nomeEnc, waId){
  const mesi = parseInt(sel.value || 0, 10);
  const box  = sel.parentElement.querySelector('.rata');
  const btn  = document.getElementById(waId);
  const nome = decodeURIComponent(nomeEnc);

  let msg = `Preventivo per ${nome}\nPrezzo totale: â‚¬ ${money(prezzo)}`;

  if(!mesi){
    box.textContent = '';
    btn.href = WA + encodeURIComponent(msg);
    return;
  }
  const rata = prezzo / mesi;
  box.textContent = `Rata mensile: â‚¬ ${money(rata)} / mese (${mesi} mesi)`;

  msg += `\n\nRate: ${mesi} mesi`;
  msg += `\nRata mensile: â‚¬ ${money(rata)}/mese`;
  msg += `\n\nRichiedo un preventivo dettagliato.`;
  btn.href = WA + encodeURIComponent(msg);
}

/* ===== Stato globale ===== */
let ALL = [];

/* ===== Init ===== */
(async function init(){
  const status = document.getElementById('status');
  const filters= document.getElementById('filters');

  try{
    const res = await fetch(DATA_URL + '?v=' + Date.now(), {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP ' + res.status);
    ALL = await res.json();

    renderGrid(ALL);
    status.textContent = `Prodotti: ${ALL.length}`;

    const brands = ['all', ...new Set(ALL.map(p=>p.brand))];
    filters.innerHTML = brands.map(b=>`
      <button data-b="${b}" onclick="filterBrand('${b}')">${b==='all'?'Tutti':b}</button>
    `).join('');
    const first = filters.querySelector('button'); if(first) first.classList.add('active');

  }catch(err){
    document.querySelector('.wrap').insertAdjacentHTML('afterbegin',
      `<div class="error"><b>Impossibile caricare i prodotti.</b><br>
       Metti <code>prodotti.json</code> nello stesso percorso e le immagini in <code>/imgcatalogo/</code> (es. <code>"img":"iphone17.jpg"</code>).<br>
       Errore: ${err.message}</div>`
    );
    status.textContent = 'Errore caricamento';
  }
})();

/* ===== Helpers ===== */
function renderGrid(list){
  const grid = document.getElementById('grid');
  grid.innerHTML = list.map((p,i)=>renderCard(p,i)).join('');
}
function filterBrand(b){
  const btns = document.querySelectorAll('.filters button');
  btns.forEach(x=>x.classList.remove('active'));
  const cur = document.querySelector(`.filters button[data-b="${b}"]`);
  cur && cur.classList.add('active');

  const list = (b==='all') ? ALL : ALL.filter(p=>p.brand===b);
  renderGrid(list);
}
</script>
</body>
</html>
