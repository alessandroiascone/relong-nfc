<!DOCTYPE html>
<html lang='it'>
<head>
<link rel="preconnect" href="https://wa.me" crossorigin>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Re Long | Catalogo Pro (Filtri ‚Ä¢ Badge ‚Ä¢ Dark 3D ‚Ä¢ WhatsApp)</title>
<meta name='theme-color' content='#0a0a0a'>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-font-smoothing:antialiased}
:root{
  --bg1:#0a0a0a;--bg2:#000;
  --card:rgba(25,25,25,.92);
  --stroke:rgba(255,255,255,.08);
  --wa1:#25D366;--wa2:#128C7E;
  --muted:rgba(255,255,255,.7);
  --brand1:#ff0000;--brand2:#ff7b00;
}
body{font-family:system-ui,-apple-system,Inter,Roboto,sans-serif;background:radial-gradient(circle at 20% 20%,var(--bg1),var(--bg2));color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;transition:background .3s ease}
.wrap{width:100%;max-width:1240px;display:grid;gap:18px}
.head{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:10px}
.title{font-weight:900;letter-spacing:-.03em;font-size:24px}
.controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.btn-filter{padding:10px 14px;border-radius:999px;border:1px solid var(--stroke);background:rgba(255,255,255,.05);color:#fff;font-weight:800;cursor:pointer;transition:transform .15s, box-shadow .2s}
.btn-filter.active{background:linear-gradient(90deg,var(--brand1),var(--brand2));color:#000;border-color:transparent;box-shadow:0 10px 24px rgba(255,90,0,.35)}
.toggle{padding:10px 14px;border-radius:12px;border:1px solid var(--stroke);background:rgba(255,255,255,.06);cursor:pointer}
.grid{display:grid;grid-template-columns:1fr;gap:16px}
@media(min-width:760px){.grid{grid-template-columns:1fr 1fr}}
@media(min-width:1100px){.grid{grid-template-columns:1fr 1fr 1fr 1fr}}
.card{position:relative;background:var(--card);padding:16px;border-radius:18px;border:1px solid var(--stroke);box-shadow:0 28px 60px rgba(0,0,0,.85), 0 0 50px rgba(255,0,0,.12);transform:perspective(800px) rotateX(0) rotateY(0);transition:transform .25s ease, box-shadow .25s ease, background .3s}
.card:hover{transform:perspective(800px) rotateX(2deg) rotateY(-2deg);box-shadow:0 40px 90px rgba(0,0,0,.9), 0 0 80px rgba(255,0,0,.18)}
.photo{width:100%;border-radius:12px;aspect-ratio:1/1;object-fit:contain;background:#000}

.photo-wrap{position:relative;border-radius:12px;perspective:800px}
.photo{transition:transform .25s ease, box-shadow .25s ease, filter .25s ease}
.card:hover .photo{box-shadow:0 14px 36px rgba(255,0,0,.18),0 0 28px rgba(255,123,0,.28);filter:saturate(1.05)}

.model{font-size:18px;font-weight:900;margin-top:6px}
.price{font-size:15px;margin-bottom:8px;color:var(--muted)}
.badges{position:absolute;top:10px;left:10px;display:flex;flex-wrap:wrap;gap:6px}
.tag{font-size:11px;font-weight:800;padding:6px 10px;border-radius:999px;backdrop-filter:blur(6px)}
.tag.brand{background:linear-gradient(90deg,var(--brand1),var(--brand2));color:#000}
.tag.new{background:linear-gradient(90deg,#00e1ff,#0078ff);}
.tag.stock{background:linear-gradient(90deg,#aaff00,#27ae60);}
.tag.hot{background:linear-gradient(90deg,#ffd500,#ff7b00);color:#000}
.btn{display:block;margin-top:10px;text-align:center;padding:12px;border-radius:12px;background:radial-gradient(circle at 0% 0%,var(--wa1),var(--wa2));color:#000;font-weight:900;text-decoration:none;box-shadow:0 18px 30px rgba(18,140,126,.45)}
.btn.secondary{background:linear-gradient(90deg,#ffd166,#ff7b00);color:#000;box-shadow:0 14px 24px rgba(255,123,0,.35)}
.simulatore{margin-top:12px;padding:12px;border:1px solid var(--stroke);border-radius:12px;background:rgba(255,255,255,.05)}
.sim-label{font-size:14px;color:var(--muted)}
.sim-select{width:100%;margin-top:6px;padding:8px;border-radius:10px;background:#0f0f0f;color:#fff;border:1px solid rgba(255,255,255,.15)}
.sim-output{margin-top:8px;font-size:15px;font-weight:700;color:#ffd166}

/* Dark mode toggle */
:root.dark{--bg1:#000;--bg2:#0a0a0a;--card:rgba(10,10,10,.94);--stroke:rgba(255,255,255,.12)}

/* ===== WhatsApp Cart ‚Äî Style C (pill + centered modal) ===== */
#rl-cart-fab{position:fixed;right:16px;bottom:calc(16px + env(safe-area-inset-bottom));z-index:9999}
#rl-cart-fab button{display:flex;align-items:center;gap:10px;background:linear-gradient(90deg,#ff0000,#ff7b00);color:#000;border:0;border-radius:999px;padding:12px 16px;font-weight:900;box-shadow:0 18px 30px rgba(255,90,0,.35)}
#rl-cart-fab .badge{background:#000;color:#fff;border-radius:999px;padding:6px 10px;font-weight:900}
#rl-cart-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:blur(4px);z-index:10000}
#rl-cart-modal .card{width:min(92vw,520px);background:linear-gradient(160deg, rgba(20,20,20,.98), rgba(0,0,0,.82));border:1px solid rgba(255,255,255,.12);border-radius:18px;box-shadow:0 26px 58px rgba(0,0,0,.75);padding:16px}
#rl-cart-modal .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
#rl-cart-modal h3{font-size:18px;font-weight:900;margin:0}
#rl-cart-modal .list{max-height:52vh;overflow:auto;margin:6px 0 12px 0;border:1px solid rgba(255,255,255,.08);border-radius:12px}
#rl-cart-modal .row{display:flex;justify-content:space-between;gap:10px;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.08)}
#rl-cart-modal .row:last-child{border-bottom:0}
#rl-cart-modal .name{font-weight:700}
#rl-cart-modal .price{opacity:.9}
#rl-cart-modal .act{display:flex;gap:8px;justify-content:flex-end}
#rl-cart-modal .btn{background:linear-gradient(90deg,#ff0000,#ff7b00);color:#000;border:0;border-radius:12px;padding:10px 12px;font-weight:900;cursor:pointer}
#rl-cart-modal .btn.ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.16)}
.addcart-btn{display:inline-block;margin-top:8px;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.04);color:#fff;font-size:12px;font-weight:800;text-decoration:none;cursor:pointer}
.addcart-btn:hover{filter:brightness(1.08)}
@media (max-width:480px){
  #rl-cart-fab button span.txt{display:none}
}


/* Performance tweaks */
.photo{will-change: transform;}
@media (prefers-reduced-motion: reduce){
  .card:hover{transform:none; box-shadow:0 28px 60px rgba(0,0,0,.85), 0 0 50px rgba(255,0,0,.12)}
  .photo{transition:none !important; transform:none !important}
}
.photo{content-visibility:auto; contain-intrinsic-size:400px 400px}

</style>
</head>
<body>
<main class="wrap">
  <div class="head">
    <div class="title">Catalogo Smartphone a Rate - Assicurazione Kasko ed Accessori Inclusi</div>
    <div class="controls">
      <button class="btn-filter active" data-filter="all">Tutti</button>
      <button class="btn-filter" data-filter="Apple">Apple</button>
      <button class="btn-filter" data-filter="Samsung">Samsung</button>
      <button class="btn-filter" data-filter="OPPO">OPPO</button>
      <button class="btn-filter" data-filter="HONOR">HONOR</button>
      <button class="toggle" id="darkToggle">üåô Dark 3D</button>
      <button class="toggle" id="badgeToggle">üè∑Ô∏è Badge Dinamici: ON</button>
    </div>
  </div>

  <section class="grid" id="grid"></section>
</main>

<script>
const WA = "3908119578844";

// === Badge Dinamici ===
window.dynamicBadges = true;
function computeBadges(p){
  const base = Array.isArray(p.tags) ? [...p.tags] : [];
  if(window.dynamicBadges){
    // Regole base
    if (p.prezzo <= 200 && !base.includes("Convenienza")) base.push("Convenienza");
    if ((p.id&&/17|S25|14F|400/i.test(p.id)) || /17|S25|14F|400/i.test(p.nome)) {
      if (!base.includes("Novit√†")) base.push("Novit√†");
    }
    if (p.brand === "Apple" && p.prezzo >= 1500 && !base.includes("Premium")) base.push("Premium");
  }
  return [...new Set(base)];
}
// Bottone toggle
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("badgeToggle");
  if(btn){
    btn.addEventListener("click", () => {
      window.dynamicBadges = !window.dynamicBadges;
      btn.textContent = window.dynamicBadges ? "üè∑Ô∏è Badge Dinamici: ON" : "üè∑Ô∏è Badge Dinamici: OFF";
      // Rerender mantenendo filtro attivo
      const active = document.querySelector(".btn-filter.active");
      const key = active ? active.dataset.filter : "all";
      render(key||"all"); attachTilt();
    ticking = false; });
  }
});


// Dati centralizzati (iPhone 17 e iPhone Air aggiornati)
const prodotti = [
  { id:"iphone17pro", brand:"Apple", nome:"iPhone 17 Pro 256GB", prezzo:1489, img:"img/iphone17pro.png", tags:["Bestseller"] },
  { id:"iphone17", brand:"Apple", nome:"iPhone 17 256GB", prezzo:1109, img:"img/iphone17.webp", tags:["Novit√†"] },
  { id:"iphone_air", brand:"Apple", nome:"iPhone Air 512GB", prezzo:1657, img:"img/iphone_air.webp", tags:[] },
  { id:"ip17promax", brand:"Apple", nome:"iPhone 17 Pro Max 256GB", prezzo:1657.8, img:"img/ip17promax.webp", tags:["Ultimi pezzi"] },

  { id:"s25", brand:"Samsung", nome:"Galaxy S25 Ultra 256GB", prezzo:985.9, img:"img/s25.png", tags:["Bestseller"] },
  { id:"a56", brand:"Samsung", nome:"Galaxy A56 5G 128GB", prezzo:483.8, img:"img/a56.webp", tags:["Novit√†"] },
  { id:"zfold7", brand:"Samsung", nome:"Galaxy Z Fold 7 256GB", prezzo:1977, img:"img/zfold7.webp", tags:["Premium"] },

  { id:"a5pro", brand:"OPPO", nome:"OPPO A5 Pro 256GB", prezzo:255.9, img:"img/a5pro.webp", tags:["Convenienza"] },

  { id:"a17_256", brand:"Samsung", nome:"Samsung Galaxy A17 256GB", prezzo:315, img:"img/a17_256.webp", tags:["Convenienza"] },
  { id:"iphone17pro_1tb", brand:"Apple", nome:"iPhone 17 Pro 1TB", prezzo:1993, img:"img/iphone17pro_1tb.webp", tags:["Premium","Novit√†"] },
  { id:"honor400lite_256", brand:"HONOR", nome:"HONOR 400 Lite 256GB", prezzo:159, img:"img/honor400lite_256.png", tags:["Novit√†","Convenienza"] },
  { id:"oppo14f_256", brand:"OPPO", nome:"OPPO 14F 256GB", prezzo:255, img:"img/oppo14f_256.webp", tags:["Novit√†"] },
  { id:"s25fe_256", brand:"Samsung", nome:"Galaxy S25 FE 256GB", prezzo:773, img:"img/s25fe_256.webp", tags:["Novit√†"] },
];

function badgeClass(tag){ if(tag==="Novit√†") return "tag new"; if(tag==="Ultimi pezzi") return "tag stock"; if(tag==="Bestseller") return "tag hot"; if(tag==="Premium") return "tag brand"; if(tag==="Convenienza") return "tag stock"; return "tag"; }

function cardHTML(p){
  const waUrl = "https://wa.me/"+WA+"?text="+encodeURIComponent("Ciao Re Long, voglio info su "+p.nome+"!");
  const badges = computeBadges(p).map(t => `<span class="${badgeClass(t)}">${t}</span>`).join("");
  return `
    <article class="card" data-brand="${p.brand}">
      <div class="badges">
        <span class="tag brand">${p.brand}</span>
        ${badges}
      </div>
      <div class="photo-wrap"><img class="photo" src="${p.img}" alt="${p.nome}" loading="lazy" decoding="async" fetchpriority="low"></div>
      <div class="model">${p.nome}</div>
      <p class="price">Prezzo totale: ‚Ç¨ ${p.prezzo}</p>
      <div class="simulatore">
        <label class="sim-label">Simula la tua rata:</label>
        <select class="sim-select" onchange="calcolaRata(this, ${p.prezzo})">
          <option value="">Seleziona durata</option>
          <option value="12">12 mesi</option>
          <option value="24">24 mesi</option>
          <option value="30">30 mesi</option>
          <option value="36">36 mesi</option>
          <option value="48">48 mesi</option>
        </select>
        <div class="sim-output">Rata mensile: ‚Äî</div>
      </div>
      <a class="btn" href="${waUrl}" target="_blank" rel="noopener">üí¨ Chatta su WhatsApp</a>
      <button class="btn secondary" onclick="inviaSimulazione(this, '${p.nome}', ${p.prezzo})">üì§ Invia simulazione su WhatsApp</button>
    </article>
  `;
}

function render(filter="all"){ const grid=document.getElementById("grid"); grid.innerHTML=""; prodotti.filter(p => filter==="all" ? true : p.brand===filter).forEach(p => grid.innerHTML += cardHTML(p)); }
render();
attachTilt();

// Filtri cliccabili
document.querySelectorAll(".btn-filter").forEach(btn => { btn.addEventListener("click", () => { document.querySelectorAll(".btn-filter").forEach(b=>b.classList.remove("active")); btn.classList.add("active"); render(btn.dataset.filter); attachTilt(); }); });

// Toggle Dark 3D
document.getElementById("darkToggle").addEventListener("click", () => { document.documentElement.classList.toggle("dark"); });

// Simulatore
function calcolaRata(select, prezzo){ const mesi=parseInt(select.value); const out=select.parentElement.querySelector('.sim-output'); if(!mesi){ out.textContent="Rata mensile: ‚Äî"; return; } out.textContent="Rata mensile: ‚Ç¨ "+(prezzo/mesi).toFixed(2); }

// Invia simulazione su WhatsApp
function inviaSimulazione(btn, nome, prezzo){ const card = btn.closest('.card'); const select = card.querySelector('.sim-select'); const mesi = parseInt(select?.value || ""); if(!mesi){ alert("Seleziona la durata (12/24/30/36/48 mesi) prima di inviare la simulazione."); return; } const rata = (prezzo/mesi).toFixed(2); const msg = `Ciao Re Long, ho simulato ${nome}: prezzo ‚Ç¨ ${prezzo}, durata ${mesi} mesi, rata ‚Ç¨ ${rata}/mese. Mi confermi disponibilit√†?`; const url = "https://wa.me/"+WA+"?text="+encodeURIComponent(msg); window.open(url, "_blank"); }


// === Tilt 3D sulle foto ===
function attachTilt(){
  let ticking = false;

  document.querySelectorAll('.card').forEach(card => {
    const img = card.querySelector('.photo');
    if(!img) return;
    const strength = 6; // gradi max
    card.addEventListener('mousemove', (e) => { if(ticking) return; ticking = true; window.requestAnimationFrame(()=>{
      const r = card.getBoundingClientRect();
      const x = (e.clientX - r.left) / r.width;
      const y = (e.clientY - r.top) / r.height;
      const rx = (y - 0.5) * strength;
      const ry = (x - 0.5) * -strength;
      img.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg) translateZ(8px)`;
    });
    card.addEventListener('mouseleave', () => {
      img.style.transform = 'rotateX(0) rotateY(0) translateZ(0)';
    });
  });
}
</script>

<!-- WhatsApp Cart ‚Äî Style C -->
<div id="rl-cart-fab" aria-label="Carrello WhatsApp">
  <button type="button" id="rl-cart-open">
    üõí <span class="txt">Carrello</span> <span class="badge" id="rl-cart-badge">0</span>
  </button>
</div>
<div id="rl-cart-modal" role="dialog" aria-modal="true" aria-label="Carrello WhatsApp">
  <div class="card">
    <div class="head">
      <h3>Carrello WhatsApp</h3>
      <button class="btn ghost" id="rl-cart-close">Chiudi</button>
    </div>
    <div class="list" id="rl-cart-list"></div>
    <div class="act">
      <button class="btn ghost" id="rl-cart-clear">Svuota</button>
      <button class="btn" id="rl-cart-send">Invia su WhatsApp</button>
    </div>
  </div>
</div>


<script>
// ===== WhatsApp Cart Core =====
(function(){
  const WA_NUM = "3908119578844"; // IT +39 + 08119578844
  const KEY = "rl_cart";
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  function getCart(){ try { return JSON.parse(localStorage.getItem(KEY) || "[]"); } catch { return []; } }
  function setCart(v){ localStorage.setItem(KEY, JSON.stringify(v)); updateBadge(); }
  function updateBadge(){
    const n = getCart().length;
    const b = $("#rl-cart-badge");
    if (b) b.textContent = n;
  }

  function listToHTML(items){
    if (!items.length) return '<div class="row"><div>Carrello vuoto</div></div>';
    return items.map(x => `
      <div class="row" data-sku="${(x.sku||"").replace(/"/g,'&quot;')}">
        <div>
          <div class="name">${(x.name||x.sku||"Senza nome").replace(/</g,'&lt;')}</div>
          ${x.price != null ? `<div class="price">‚Ç¨ ${x.price}</div>` : ""}
        </div>
        <div class="act">
          <button class="btn ghost rl-remove" data-sku="${(x.sku||"").replace(/"/g,'&quot;')}">Rimuovi</button>
        </div>
      </div>`).join("");
  }

  function openModal(){
    const modal = $("#rl-cart-modal");
    const list = $("#rl-cart-list");
    list.innerHTML = listToHTML(getCart());
    modal.style.display = "flex";
  }
  function closeModal(){ $("#rl-cart-modal").style.display="none"; }

  function sendCart(){
    const items = getCart();
    if (!items.length) return alert("Carrello vuoto");
    const lines = items.map((x,i)=>`${i+1}) ${x.name||x.sku}${x.price!=null?(" ‚Äî ‚Ç¨"+x.price):""}`).join("\n");
    const msg = `Ciao Re Long, vorrei un preventivo per:\n${lines}\nGrazie!`;
    const url = `https://wa.me/${WA_NUM}?text=${encodeURIComponent(msg)}`;
    window.open(url, "_blank");
  }

  // Public API
  window.RLCart = {
    add: (item)=>{
      const arr = getCart();
      arr.push(item);
      setCart(arr);
      toast("Aggiunto: " + (item.name || item.sku || "Articolo"));
    },
    remove:(sku)=>{ setCart(getCart().filter(x=>x.sku!==sku)); toast("Rimosso: " + sku); },
    clear: ()=>{ setCart([]); toast("Carrello svuotato"); },
    list: getCart
  };

  // UI hooks
  document.addEventListener("click", (e)=>{
    const add = e.target.closest("[data-cart-add]");
    if (add){
      e.preventDefault();
      try{
        const data = JSON.parse(add.getAttribute("data-cart-add"));
        if (!data.sku) data.sku = (data.name||"ARTICOLO").toUpperCase().replace(/\W+/g,"-").slice(0,20);
        window.RLCart.add(data);
      }catch(err){
        console.error("data-cart-add non valido", err);
      }
    }
    const rm = e.target.closest(".rl-remove");
    if (rm){
      e.preventDefault();
      const sku = rm.getAttribute("data-sku");
      window.RLCart.remove(sku);
      // refresh list
      const lst = $("#rl-cart-list");
      lst.innerHTML = listToHTML(getCart());
    }
  });

  // Modal controls
  $("#rl-cart-open")?.addEventListener("click", openModal);
  $("#rl-cart-close")?.addEventListener("click", closeModal);
  $("#rl-cart-clear")?.addEventListener("click", ()=>{ window.RLCart.clear(); $("#rl-cart-list").innerHTML = listToHTML([]); });
  $("#rl-cart-send")?.addEventListener("click", sendCart);
  $("#rl-cart-modal")?.addEventListener("click", (e)=>{ if(e.target.id==="rl-cart-modal") closeModal(); });

  // Toast utility (reuses .toast if present; else creates)
  function toast(msg){
    let t = document.querySelector('.toast');
    if(!t){ t = document.createElement('div'); t.className='toast'; document.body.appendChild(t); }
    t.textContent = msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 2000);
  }

  updateBadge();

  // ===== Auto-augment: add unobtrusive "Aggiungi al carrello" buttons =====
  // Heuristics for common card structures in provided pages
  function addButtons(){
    const selectorCandidates = [
      // likely product cards
      ".product-card",
      ".phone-card",
      ".device-card",
      ".catalog-card",
      ".item-card",
      // generic cards but only if they contain a price-like text
      "article.card"
    ];

    const isPricey = (el)=>/\b‚Ç¨\s?\d/.test(el.textContent.replace(",", "."));

    const seen = new WeakSet();
    selectorCandidates.forEach(sel=>{
      document.querySelectorAll(sel).forEach(card=>{
        if (seen.has(card)) return;
        let title = card.querySelector(".title, h3, h2, .name, .product-title");
        let priceEl = card.querySelector(".price, .prezzo, .product-price, .amount");
        let priceText = priceEl?.textContent or None
        if priceText:
            priceText = priceText.strip()
        # Only add on product-like cards
        cond_ok = title is not None and (priceEl is not None or isPricey(card))
        if not cond_ok:
            return
        # Avoid duplicates
        if card.querySelector(".addcart-btn"):
            return
        # Guess data
        name = (title.textContent or "Articolo").strip()
        name = re.sub(r"\s+", " ", name)
        price = None
        if priceEl:
            # try to parse number
            import re as _re
            m = _re.search(r"(\d+[.,]?\d*)", priceEl.textContent)
            if m:
                price = m.group(1).replace(",", ".")
                try:
                    price = float(price)
                except:
                    price = None

        # place button after the first .btn or at the card end
        insertAfterEl = card.querySelector(".btn") or card
        btn = document.createElement("a")
        btn.className = "addcart-btn"
        payload = {"name": name}
        if price is not None:
            payload["price"] = price
        btn.setAttribute("data-cart-add", JSON.stringify(payload))
        btn.textContent = "‚ûï Aggiungi al carrello"
        if insertAfterEl === card:
            card.appendChild(btn)
        else:
            insertAfterEl.insertAdjacentElement("afterend", btn)
        seen.add(card)
      })
    });
  }

  // Run after DOM ready
  if (document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", addButtons);
  } else {
    addButtons();
  }
})();
</script>

</body>
</html>
